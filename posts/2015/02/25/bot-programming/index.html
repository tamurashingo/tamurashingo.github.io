<!DOCTYPE html>
<html lang="ja-jp">
    <head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<title>
				bot programming &middot; Web技術と親しむ
		</title>

		
  		<link rel="stylesheet" href="/css/style.css">
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Libre+Baskerville:400,400i,700">
		
		<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
		<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
		<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

		
		<link href="" rel="alternate" type="application/rss+xml" title="Web技術と親しむ" />
	</head>

    <body>
        		<nav class="nav">
			<div class="nav-container">
				<a href="/">
					<h2 class="nav-title">Web技術と親しむ</h2>
				</a>
				<ul>
    <li><a href="/about">About</a></li>
    <li><a href="/">Posts</a></li>
</ul>
			</div>
		</nav>

        

<main>
	<div class="post">
		<div class="post-info">
    <span>Written by</span>
        
        <br>
        <span>on&nbsp;</span><time datetime="2015-02-25 23:58:53 &#43;0000 UTC">February 25, 2015</time>
</div>
		<h1 class="post-title">bot programming</h1>
<div class="post-line"></div>

		


		

<p>tamuraです。ネタです。</p>

<h2 id="発表者をランダムで指名するbot">発表者をランダムで指名するbot</h2>

<p>社内勉強会のときに使えるかなーと思い、作ってみました。 対話型で発表者のリストに発表者を追加して行き、 発表する時間になったらそのリストからランダムで発表者を選ぶという簡単なbotです。</p>

<!-- more -->

<p><a href="https://github.com/tamurashingo/mybot">https://github.com/tamurashingo/mybot</a></p>

<h2 id="実際の動作">実際の動作</h2>

<pre><code>Hubot&gt; hubot presenter add
Shell: 発表者をリストに追加します。終了する場合は &lt;end&gt; と入力してください。
Hubot&gt; ichiro
Shell: 'ichiro' さんをリストに追加しました。
Hubot&gt; Shell: 続けて発表者をリストに追加します。終了する場合は &lt;end&gt; と入力してください。
Hubot&gt; jiro
Shell: 'jiro' さんをリストに追加しました。
Hubot&gt; Shell: 続けて発表者をリストに追加します。終了する場合は &lt;end&gt; と入力してください。
Hubot&gt; saburo
Shell: 'saburo' さんをリストに追加しました。
Hubot&gt; Shell: 続けて発表者をリストに追加します。終了する場合は &lt;end&gt; と入力してください。
Hubot&gt; shiro
Shell: 'shiro' さんをリストに追加しました。
Hubot&gt; Shell: 続けて発表者をリストに追加します。終了する場合は &lt;end&gt; と入力してください。
Hubot&gt; &lt;end&gt;
Hubot&gt; hubot presenter show
発表者リスト
Hubot&gt;   1:ichiro さん
Hubot&gt;   2:jiro さん
Hubot&gt;   3:saburo さん
Hubot&gt;   4:shiro さん
Hubot&gt; hubot presenter select
Shell: 'saburo'さん、お願いします！
Hubot&gt; hubot presenter select
Shell: 'jiro'さん、お願いします！
Hubot&gt; hubot presenter select
Shell: 'shiro'さん、お願いします！
Hubot&gt; hubot presenter select
Shell: 'ichiro'さん、お願いします！
</code></pre>

<h3 id="参考サイト">参考サイト</h3>

<p><a href="https://ja.ngs.io/2014/12/14/hubot-qiita/">Slack と Qiita:Team を使って気楽に日報 #qiita_hackathon</a></p>

<p>こんな感じで対話型のbotを作りたかったので、ソースを参考にさせていただきました。 というかbotとの対話部分はコピーです。</p>

<p>```coffeescript</p>

<h1 id="主に発表者をランダムで指定する">主に発表者をランダムで指定する</h1>

<h1 id="description">Description:</h1>

<h1 id="発表者のリストを作成し-その中からランダムで発表者を選ぶ">発表者のリストを作成し、その中からランダムで発表者を選ぶ.</h1>

<p>#</p>

<h1 id="commands">Commands:</h1>

<h1 id="presenter-show-リストに登録されている発表者を表示する">presenter show - リストに登録されている発表者を表示する</h1>

<h1 id="presenter-add-発表者をリストに登録する">presenter add - 発表者をリストに登録する</h1>

<h1 id="presenter-del-num-リストの-num-番目に登録している発表者をリストから削除する">presenter del <num>- リストの<num>番目に登録している発表者をリストから削除する</h1>

<h1 id="presenter-select-発表者を選ぶ">presenter select - 発表者を選ぶ</h1>

<h1 id="presenter-clear-リストを空にする">presenter clear - リストを空にする</h1>

<p>#</p>

<p>presenterList = []</p>

<p>{TextListener} = require &lsquo;hubot/src/listener&rsquo;</p>

<p>module.exports = (robot) -&gt;
  removeListener = (listener) -&gt;
    index = robot.listeners.indexOf listener
    robot.listeners.splice index, 1 if index != 1</p>

<p>waitForAnswer = (waitMsg, callback) -&gt;
    userId = waitMsg.envelope.user.id
    room = waitMsg.envelope.room
    listener = new TextListener robot, /.*/, (msg) -&gt;
      {envelope} = msg
      if envelope.room is room and envelope.user.id is userId
        callback.apply null, arguments
        removeListener listener
    robot.listeners.push listener</p>

<p>waitForResponse = (waitMsg, callback) -&gt;
    userId = waitMsg.envelope.user.id
    room = waitMsg.envelope.room
    listener = new TextListener robot, /.*/, (msg) -&gt;
      {envelope} = msg
      if envelope.room is room and envelope.user.id is userId
        if msg.envelope.message.text.toLowerCase() is &lsquo;end&rsquo;
          removeListener listener
        else
          callback.apply null, arguments
    robot.listeners.push listener</p>

<p>robot.respond /presenter\s+show/i, (msg) -&gt;
    msg.send &lsquo;発表者リスト&rsquo;
    for name, idx in presenterList
      msg.send \&rdquo; #{idx + 1}:#{name} さん\&rdquo;</p>

<p>robot.respond /presenter\s+add/i, (msg) -&gt;
    msg.reply &lsquo;発表者をリストに追加します。終了する場合は end と入力してください。&rsquo;
    waitForResponse msg, (msg) -&gt;
      presenter = msg.envelope.message.text
      presenterList.push(presenter)
      msg.reply \&ldquo;&lsquo;#{presenter}&rsquo; さんをリストに追加しました。\&rdquo;
      msg.reply &lsquo;続けて発表者をリストに追加します。終了する場合は end と入力してください。&rsquo;</p>

<p>robot.respond /presenter\s+del\s+([0-9]+)/i, (msg) -&gt;
    idx = parseInt(msg.match[1]) - 1
    presenter = presenterList[idx]
    presenterList.splice idx, 1
    msg.reply \&ldquo;&lsquo;#{presenter}&rsquo; さんをリストから削除しました。\&rdquo;</p>

<p>robot.respond /presenter\s+select/i, (msg) -&gt;
    if presenterList.length == 0
      msg.reply \&ldquo;リストが空です\&rdquo;
    else
      idx = Math.floor(Math.random() * presenterList.length)
      presenter = presenterList[idx]
      presenterList.splice idx, 1
      msg.reply \&ldquo;&lsquo;#{presenter}&lsquo;さん、お願いします！\&rdquo;</p>

<p>robot.respond /presenter\s+clear/i, (msg) -&gt;
    msg.reply \&ldquo;リストをクリアしますか？(Y/n)\&rdquo;
    waitForAnswer msg, (msg) -&gt;
      ans = msg.envelope.message.text
      if ans is \&ldquo;Y\&rdquo;
        presenterList = []
        msg.reply \&ldquo;リストをクリアしました\&rdquo;
      else if ans is \&ldquo;y\&rdquo;
        msg.reply \&ldquo;Y を入力してください\&rdquo;
    ```</p>


		
	</div>

	<div class="pagination">
		<a href="/posts/2015/02/25/springframework-03/" class="left arrow">&#8592;</a>
		<a href="/posts/2015/02/26/springframework-04/" class="right arrow">&#8594;</a>

		<a href="#" class="top">Top</a>
	</div>
</main>


        		<footer>
			<span>
			&copy; <time datetime="2019-04-16 21:56:01.449888 &#43;0900 JST m=&#43;0.536218412">2019</time> tamura shingo. Made with <a href='https://gohugo.io'>Hugo</a> using the <a href='https://github.com/EmielH/tale-hugo/'>Tale</a> theme.
			</span>
		</footer>

    </body>
</html>
