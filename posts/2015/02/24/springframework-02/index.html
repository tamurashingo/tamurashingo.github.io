<!DOCTYPE html>
<html lang="ja-jp">
    <head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<title>
				Spring Frameworkを使ってみるpart2 &middot; Web技術と親しむ
		</title>

		
  		<link rel="stylesheet" href="/css/style.css">
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Libre+Baskerville:400,400i,700">
		
		<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
		<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
		<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

		
		<link href="" rel="alternate" type="application/rss+xml" title="Web技術と親しむ" />
	</head>

    <body>
        		<nav class="nav">
			<div class="nav-container">
				<a href="/">
					<h2 class="nav-title">Web技術と親しむ</h2>
				</a>
				<ul>
    <li><a href="/about">About</a></li>
    <li><a href="/">Posts</a></li>
</ul>
			</div>
		</nav>

        

<main>
	<div class="post">
		<div class="post-info">
    <span>Written by</span>
        
        <br>
        <span>on&nbsp;</span><time datetime="2015-02-24 22:40:18 &#43;0000 UTC">February 24, 2015</time>
</div>
		<h1 class="post-title">Spring Frameworkを使ってみるpart2</h1>
<div class="post-line"></div>

		


		

<p>tamuraです。
今回はちょっとアプリっぽい動きのものを作ります。</p>

<!-- more -->

<h2 id="目標">目標</h2>

<ul>
<li>formに入力した値を表示する</li>
</ul>

<p><a href="https://spring.io/guides/gs/handling-form-submission/">Handling Form Submission</a>
ここの内容をやっていきます。 前回に引き続き、Mavenを使っていきます。</p>

<p>part1のソースをベースにしています。</p>

<h2 id="コントローラの改修">コントローラの改修</h2>

<p>part1では<code>@RequestMapping</code>を使って<code>/greeting</code>とメソッドを紐付けました。
今回も<code>@RequestMapping</code>を使っていきます。 part1と違うのは、HTTPリクエストのメソッドによって実行するメソッドを変更する点です。</p>

<p>src/main/java/hello/GreetingController.java</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">hello</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ModelAttribute</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMethod</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GreetingController</span> <span class="o">{</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">&#34;/greeting&#34;</span><span class="o">,</span> <span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">greetingForm</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;greeting&#34;</span><span class="o">,</span> <span class="k">new</span> <span class="n">Greeting</span><span class="o">());</span>
        <span class="k">return</span> <span class="s">&#34;greeting&#34;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">&#34;/greeting&#34;</span><span class="o">,</span> <span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">greetingSubmit</span><span class="o">(</span><span class="nd">@ModelAttribute</span> <span class="n">Greeting</span> <span class="n">greeting</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;greeting&#34;</span><span class="o">,</span> <span class="n">greeting</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;result&#34;</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></div>
<h3 id="アノテーション">アノテーション</h3>

<ul>
<li><code>@RequestMapping</code>

<ul>
<li><code>/greeting</code>へのGETリクエストと<code>greetingForm()</code>メソッドを紐付ける</li>
<li><code>/greeting</code>へのPOSTリクエストと<code>greetingSubmit()</code>メソッドを紐付ける</li>
</ul></li>
</ul>

<p><code>@ModelAttribute</code>については後述します。</p>

<h3 id="実装">実装</h3>

<ul>
<li><p><code>greetingForm</code></p>

<ul>
<li>初回のアクセスで呼ばれる想定</li>
<li><code>Greeting</code>オブジェクトをモデルにセットする</li>
<li><code>&quot;greeting&quot;</code>というビューの名前を返す</li>
</ul></li>

<li><p><code>greetingSubmit</code></p>

<ul>
<li>formでsubmitボタンが押された想定</li>
<li>画面で入力された値が引数で渡されるため、それをモデルにセットする</li>
<li><code>&quot;result&quot;</code>というビューの名前を返す</li>
</ul></li>
</ul>

<h2 id="モデルの作成">モデルの作成</h2>

<p><code>id</code>、<code>content</code>を保持するモデルを作成します。 これは<code>greeting</code>ビューで表示されるformの各フィールドの情報です。</p>

<p>src/main/java/hello/Greeting.java</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">hello</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Greeting</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kt">long</span> <span class="n">id</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">content</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="kt">long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getContent</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">content</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setContent</span><span class="o">(</span><span class="n">String</span> <span class="n">content</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></div>
<h2 id="ビューの作成">ビューの作成</h2>

<p>つづいてビューを作ります。</p>

<p>src/main/resources/templates/greeting.html</p>
<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html"><span class="cp">&lt;!doctype html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&#34;http://www.thymeleaf.org&#34;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Greeting Started: Handling Form Submission<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&#34;Content-Type&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;text/html; charset=UTF-8&#34;</span> <span class="p">/&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Form<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&#34;#&#34;</span> <span class="na">th:action</span><span class="o">=</span><span class="s">&#34;@{/greeting}&#34;</span> <span class="na">th:object</span><span class="o">=</span><span class="s">&#34;${greeting}&#34;</span> <span class="na">method</span><span class="o">=</span><span class="s">&#34;post&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Id: <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">th:field</span><span class="o">=</span><span class="s">&#34;*{id}&#34;</span> <span class="p">/&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Message: <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">th:field</span><span class="o">=</span><span class="s">&#34;*{content}&#34;</span> <span class="p">/&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;Submit&#34;</span> <span class="p">/&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;reset&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;Reset&#34;</span> <span class="p">/&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span></code></pre></div>
<p><code>th:object=&quot;${greeting}&quot;</code>という記述でformからデータを集め、 <code>th:action=&quot;@{/greeting}&quot;</code>という記述で<code>/greeting</code>へその内容をPOSTします。 <code>th:field=&quot;*{id}&quot;</code>と<code>th:field=&quot;*{content}&quot;</code>がGreetingオブジェクトのフィールドに相当します。 （ここら辺の処理を行っているのが<code>@ModelAttribute</code>のようです）</p>

<p>※違いました。Beanの内容を出力する際に、<code>greeting.id</code>、<code>bean.content</code>ではなく、 <code>*{id}</code>、<code>*{content}</code>と簡潔に書けるようにするのが<code>th:object</code>でした。</p>

<p>最後に結果表示のビューを作ります。</p>

<p>src/main/resources/templates/result.html</p>
<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html"><span class="cp">&lt;!doctype html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&#34;http://www.thymeleaf.org&#34;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Greeting Started: Handling Form Submission<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&#34;Content-Type&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;text/html; charset=UTF-8&#34;</span> <span class="p">/&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Result<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&#34;&#39;id: &#39; + ${greeting.id}&#34;</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&#34;&#39;content: &#39; + ${greeting.content}&#34;</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;/greeting&#34;</span><span class="p">&gt;</span>Submit another message<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span></code></pre></div>
<h2 id="実行可能にする">実行可能にする</h2>

<p>part1同様、実行可能なJarファイルを作成します。</p>

<p>src/main/java/hello/Application.java</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">hello</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.autoconfigure.EnableAutoConfiguration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.SpringApplication</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.ComponentScan</span><span class="o">;</span>

<span class="nd">@ComponentScan</span>
<span class="nd">@EnableAutoConfiguration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Application</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">...</span><span class="na">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="n">Application</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></div>
<h2 id="実行">実行</h2>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">mvn spring-boot:run</code></pre></div>
<p>で実行します。ブラウザを開いて <a href="http://localhost:8080/greeting">http://localhost:8080/greeting</a> にアクセスします。</p>

<p>{% asset_img form01.png form01 %}</p>

<p><code>new Greeting()</code>をした際の初期値がセットされています。</p>

<p>{% asset_img form02.png form02 %}</p>

<p>値を入力してsubmitを押すと</p>

<p>{% asset_img form03.png form03 %}</p>

<p>結果が表示されます。 日本語もいけました。</p>


		
	</div>

	<div class="pagination">
		<a href="/posts/2015/02/24/springframework-01/" class="left arrow">&#8592;</a>
		<a href="/posts/2015/02/25/springframework-03/" class="right arrow">&#8594;</a>

		<a href="#" class="top">Top</a>
	</div>
</main>


        		<footer>
			<span>
			&copy; <time datetime="2019-04-16 21:56:01.455828 &#43;0900 JST m=&#43;0.542158520">2019</time> tamura shingo. Made with <a href='https://gohugo.io'>Hugo</a> using the <a href='https://github.com/EmielH/tale-hugo/'>Tale</a> theme.
			</span>
		</footer>

    </body>
</html>
